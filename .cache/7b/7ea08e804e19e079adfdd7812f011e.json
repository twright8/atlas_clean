{"id":"modules/dashboard.js","dependencies":[{"name":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\package.json","includedInParent":true,"mtime":1741868822789},{"name":"./dashboardLayout","loc":{"line":5,"column":33,"index":157},"parent":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboard.js","resolved":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboardLayout.js"},{"name":"./dashboardCharts","loc":{"line":6,"column":33,"index":211},"parent":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboard.js","resolved":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboardCharts.js"},{"name":"./dashboardStats","loc":{"line":7,"column":32,"index":264},"parent":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboard.js","resolved":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboardStats.js"},{"name":"d3","loc":{"line":8,"column":20,"index":304},"parent":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\src\\modules\\dashboard.js","resolved":"C:\\Users\\Tom\\PycharmProjects\\health_atlas\\atlas_clean\\node_modules\\d3\\index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nexports.handleDashboardResize = handleDashboardResize;\nexports.initializeDashboard = initializeDashboard;\nexports.updateDashboard = updateDashboard;\nvar dashboardLayout = _interopRequireWildcard(require(\"./dashboardLayout\"));\nvar dashboardCharts = _interopRequireWildcard(require(\"./dashboardCharts\"));\nvar dashboardStats = _interopRequireWildcard(require(\"./dashboardStats\"));\nvar d3 = _interopRequireWildcard(require(\"d3\"));\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != typeof e && \"function\" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; } /**\n * Enhanced dashboard module that orchestrates dashboard functionality\n * with improved visualizations and insights\n */\n// Dashboard state\nvar dashboardData = [];\nvar previousData = [];\nvar timeSeriesChart;\nvar categoryChart;\nvar topCountriesChart;\nvar interconnectionChart;\nvar dateRange;\nvar chartOptions = {\n  timeSeries: {\n    yearly: false\n  },\n  category: {\n    showHealthCategories: false\n  }\n};\n\n/**\n * Initialize the dashboard visualizations\n * @param {HTMLElement} container The container element for the dashboard\n */\nfunction initializeDashboard(container) {\n  console.time('Dashboard Initialization');\n\n  // Create dashboard layout\n  dashboardLayout.createDashboardLayout(container);\n\n  // Initialize charts with empty data\n  timeSeriesChart = dashboardCharts.initializeTimeSeriesChart();\n  categoryChart = dashboardCharts.initializeCategoryChart();\n  topCountriesChart = dashboardCharts.initializeTopCountriesChart();\n  interconnectionChart = dashboardCharts.initializeInterconnectionChart();\n\n  // Setup event listeners for dashboard interactions\n  setupEventListeners();\n  console.timeEnd('Dashboard Initialization');\n}\n\n/**\n * Setup event listeners for dashboard interactions\n */\nfunction setupEventListeners() {\n  // Listen for view toggle events from the dashboardLayout\n  document.addEventListener('timeViewToggle', function (e) {\n    chartOptions.timeSeries.yearly = e.detail.yearly;\n    if (dashboardData.length > 0) {\n      dashboardCharts.updateTimeSeriesChart(timeSeriesChart, dashboardData, dateRange, chartOptions.timeSeries);\n    }\n  });\n  document.addEventListener('categoryViewToggle', function (e) {\n    chartOptions.category.showHealthCategories = e.detail.showHealthCategories;\n    if (dashboardData.length > 0) {\n      dashboardCharts.updateCategoryChart(categoryChart, dashboardData, chartOptions.category);\n    }\n  });\n  document.addEventListener('refreshRecentArticles', function () {\n    if (dashboardData.length > 0) {\n      dashboardStats.updateRecentArticles(dashboardData);\n    }\n  });\n}\n\n/**\n * Update the dashboard with filtered data\n * @param {Array} data Filtered data array\n * @param {Object} dataDateRange Object with minDate and maxDate\n */\nfunction updateDashboard(data, dataDateRange) {\n  console.time('Dashboard Update');\n\n  // Store the previous data for trend analysis\n  previousData = _toConsumableArray(dashboardData);\n\n  // Store the filtered data and date range\n  dashboardData = data;\n  dateRange = dataDateRange;\n\n  // Update each visualization with the options\n  dashboardCharts.updateTimeSeriesChart(timeSeriesChart, data, dateRange, chartOptions.timeSeries);\n  dashboardCharts.updateCategoryChart(categoryChart, data, chartOptions.category);\n  dashboardCharts.updateTopCountriesChart(topCountriesChart, data);\n  dashboardCharts.updateInterconnectionChart(interconnectionChart, data);\n  dashboardStats.updateSummaryStats(data, dateRange);\n\n  // Update additional components\n  updateKeyMetrics(data);\n  dashboardStats.updateRecentArticles(data);\n\n  // Calculate articles per month for the summary stat\n  var articlesPerMonth = calculateArticlesPerMonth(data);\n  document.getElementById('articles-per-month').textContent = articlesPerMonth;\n  console.timeEnd('Dashboard Update');\n}\n\n/**\n * Update the key metrics in the dashboard header\n * @param {Array} data Filtered data array\n */\nfunction updateKeyMetrics(data) {\n  var keyMetricsContainer = document.getElementById('key-metrics');\n  if (!keyMetricsContainer) return;\n\n  // Clear previous metrics\n  keyMetricsContainer.innerHTML = '';\n\n  // Calculate key metrics\n\n  // 1. Latest article date\n  var latestDate = getLatestArticleDate(data);\n\n  // 2. Most mentioned country\n  var topCountry = getTopCountry(data);\n\n  // 3. Most common integrity issue\n  var topCategory = getTopCategory(data);\n\n  // Create metrics HTML\n  var metricsHTML = \"\\n        <div class=\\\"key-metric\\\">\\n            <span class=\\\"key-metric-value\\\">\".concat(latestDate, \"</span>\\n            <span class=\\\"key-metric-label\\\">Latest Article</span>\\n        </div>\\n        <div class=\\\"key-metric\\\">\\n            <span class=\\\"key-metric-value\\\">\").concat(topCountry.name, \"</span>\\n            <span class=\\\"key-metric-label\\\">Most Mentioned Country</span>\\n        </div>\\n        <div class=\\\"key-metric\\\">\\n            <span class=\\\"key-metric-value\\\">\").concat(topCategory.name, \"</span>\\n            <span class=\\\"key-metric-label\\\">Top Integrity Issue</span>\\n        </div>\\n    \");\n  keyMetricsContainer.innerHTML = metricsHTML;\n}\n\n/**\n * Get the date of the most recent article\n * @param {Array} data Filtered data array\n * @returns {String} Formatted date string\n */\nfunction getLatestArticleDate(data) {\n  if (data.length === 0) return 'N/A';\n  var sortedByDate = _toConsumableArray(data).sort(function (a, b) {\n    if (!a.parsedDate || !b.parsedDate) return 0;\n    return b.parsedDate - a.parsedDate;\n  });\n  if (!sortedByDate[0].parsedDate) return 'N/A';\n\n  // Format date to DD Month YYYY\n  var date = sortedByDate[0].parsedDate;\n  var options = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  };\n  return date.toLocaleDateString(undefined, options);\n}\n\n/**\n * Get the most mentioned country and its count\n * @param {Array} data Filtered data array\n * @returns {Object} Object with country name and count\n */\nfunction getTopCountry(data) {\n  if (data.length === 0) return {\n    name: 'N/A',\n    count: 0\n  };\n  var countryCounts = {};\n  data.forEach(function (item) {\n    if (item.country && item.country.trim()) {\n      countryCounts[item.country] = (countryCounts[item.country] || 0) + 1;\n    }\n  });\n  if (Object.keys(countryCounts).length === 0) return {\n    name: 'N/A',\n    count: 0\n  };\n  var sortedCountries = Object.entries(countryCounts).sort(function (a, b) {\n    return b[1] - a[1];\n  });\n  return {\n    name: sortedCountries[0][0],\n    count: sortedCountries[0][1]\n  };\n}\n\n/**\n * Get the most common integrity issue category\n * @param {Array} data Filtered data array\n * @returns {Object} Object with category name and count\n */\nfunction getTopCategory(data) {\n  if (data.length === 0) return {\n    name: 'N/A',\n    count: 0\n  };\n  var categoryCounts = {};\n  data.forEach(function (item) {\n    if (Array.isArray(item['Corruption Categories'])) {\n      item['Corruption Categories'].forEach(function (category) {\n        if (category && category.trim()) {\n          categoryCounts[category] = (categoryCounts[category] || 0) + 1;\n        }\n      });\n    }\n  });\n  if (Object.keys(categoryCounts).length === 0) return {\n    name: 'N/A',\n    count: 0\n  };\n  var sortedCategories = Object.entries(categoryCounts).sort(function (a, b) {\n    return b[1] - a[1];\n  });\n  return {\n    name: sortedCategories[0][0],\n    count: sortedCategories[0][1]\n  };\n}\n\n/**\n * Calculate the average articles per month\n * @param {Array} data Filtered data array\n * @returns {String} Articles per month (formatted)\n */\nfunction calculateArticlesPerMonth(data) {\n  if (data.length === 0) return '0';\n\n  // Get all dates\n  var dates = data.map(function (item) {\n    return item.parsedDate;\n  }).filter(function (date) {\n    return date !== null && date !== undefined;\n  });\n  if (dates.length === 0) return '0';\n\n  // Get min and max dates\n  var minDate = new Date(Math.min.apply(Math, _toConsumableArray(dates.map(function (d) {\n    return d.getTime();\n  }))));\n  var maxDate = new Date(Math.max.apply(Math, _toConsumableArray(dates.map(function (d) {\n    return d.getTime();\n  }))));\n\n  // Calculate months between min and max dates\n  var yearDiff = maxDate.getFullYear() - minDate.getFullYear();\n  var monthDiff = maxDate.getMonth() - minDate.getMonth();\n  var totalMonths = yearDiff * 12 + monthDiff + 1; // +1 to include both start and end months\n\n  // Calculate average articles per month\n  var avgArticlesPerMonth = (data.length / totalMonths).toFixed(1);\n  return avgArticlesPerMonth;\n}\n\n/**\n * Handle window resize event to make charts responsive\n */\nfunction handleDashboardResize() {\n  if (dashboardData.length > 0) {\n    // Only update the charts, not the entire dashboard\n    dashboardCharts.updateTimeSeriesChart(timeSeriesChart, dashboardData, dateRange, chartOptions.timeSeries);\n    dashboardCharts.updateCategoryChart(categoryChart, dashboardData, chartOptions.category);\n    dashboardCharts.updateTopCountriesChart(topCountriesChart, dashboardData);\n    dashboardCharts.updateInterconnectionChart(interconnectionChart, dashboardData);\n  }\n}\nvar _default = exports.default = {\n  initializeDashboard: initializeDashboard,\n  updateDashboard: updateDashboard,\n  handleDashboardResize: handleDashboardResize\n};"},"sourceMaps":null,"error":null,"hash":"f716b062bc0c3c2c5fcadc569b2045ee","cacheData":{"env":{}}}