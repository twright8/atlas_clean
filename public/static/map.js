parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"quTw":[function(require,module,exports) {
function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e){return a(e)||r(e)||o(e)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function r(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function a(e){if(Array.isArray(e))return i(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(t){var n=d(t,"string");return"symbol"==e(n)?n:String(n)}function d(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}document.addEventListener("DOMContentLoaded",function(){console.time("Total Initialization"),console.log("Initialization started");var e=document.getElementById("infoCardOverlay");sessionStorage.getItem("hasVisitedBefore")||setTimeout(function(){e.classList.add("show")},100),document.getElementById("closeInfoCard").addEventListener("click",function(){e.classList.remove("show"),sessionStorage.setItem("hasVisitedBefore","true")}),console.time("Map Initialization");var n=L.map("map").setView([0,0],2),o=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:10}),r=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.png",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:10}),a=document.querySelectorAll(".switch-button"),i=document.getElementById("map-overview-btn"),c=(document.getElementById("list-btn"),document.getElementById("map")),s=document.getElementById("mask");function u(){i.classList.contains("active")?(c.style.display="block",s.style.display="none"):(c.style.display="none",s.style.display="block")}a.forEach(function(e){e.addEventListener("click",function(){a.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),u()})}),u();var d=o.addTo(n);var p=0;d.on("tileerror",function(e){console.log("Tile loading error:",e),++p>=5&&(console.log("".concat(5," consecutive errors. Switching tile layer.")),n.removeLayer(d),d===o?(d=r.addTo(n),console.log("Switched to Stamen Terrain tiles")):(d=o.addTo(n),console.log("Switched to OpenStreetMap tiles")),p=0)}),d.on("tileload",function(){p=0});var f=L.markerClusterGroup({chunkedLoading:!0,chunkInterval:200,chunkDelay:50});n.addLayer(f),console.timeEnd("Map Initialization"),console.time("DataTable Initialization");var h=$("#dc-data-table").DataTable({searching:!1,lengthChange:!1,columns:[{data:"Title",width:"50%",defaultContent:"N/A",render:function(e,t,n){return e?'"'.concat(e,'"'):"N/A"}},{data:"country"},{data:"url",render:function(e,t,n){return e?'<a href="'.concat(e,'" target="_blank">Link</a>'):""}},{data:"Date"},{data:"Corruption Categories",render:function(e,t,n){return e?String(e).replace(/,(?=[^\s])/g,", "):""}}],columnDefs:[{type:"date-eu",targets:3}],order:[[3,"desc"]]});console.timeEnd("DataTable Initialization"),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"date-eu-pre":function(e){return e.indexOf("Cancelled")>-1&&(e=e.split(" ")[0]),j(e)},"date-eu-asc":function(e,t){return e<t?-1:e>t?1:0},"date-eu-desc":function(e,t){return e<t?1:e>t?-1:0}});var m=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function g(e){return m.format(e)}var y,v,b=[],w=[],k=new Map;function D(e,t){var n;return function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){clearTimeout(n),e.apply(void 0,r)},t)}}console.time("Data Fetching"),fetch("./data/loc3.json").then(function(e){return e.json()}).then(function(e){console.timeEnd("Data Fetching"),function(e){console.time("Data Processing");var n=d3.timeParse("%d/%m/%y");b=e.map(function(e){return l(l({},e),{},{parsedDate:n(e.Date)})}),$(".total-count").text(g(b.length));var o=t(new Set(b.map(function(e){return e.country}))).sort(function(e,t){return e.localeCompare(t)}),r=t(new Set(b.flatMap(function(e){return e["Corruption Categories"]}))).sort(function(e,t){return e.localeCompare(t)}),a=t(new Set(b.flatMap(function(e){return e["Sector Categories"]}))).sort(function(e,t){return e.localeCompare(t)});x("#countryFilter",o,"Select multiple"),x("#corruptionCategoriesFilter",r,"Select multiple"),x("#healthCategoriesFilter",a,"Select multiple"),y=d3.min(b,function(e){return e.parsedDate}),v=d3.max(b,function(e){return e.parsedDate}),$("#startDate, #endDate").datepicker({format:"dd/mm/yy",autoclose:!0}).on("changeDate",function(){B(),A()}),$("#startDate").datepicker("setDate",y),$("#endDate").datepicker("setDate",v),$("#resetFilters").on("click",function(){O()&&($("#countryFilter, #corruptionCategoriesFilter, #healthCategoriesFilter").val(null).trigger("change"),$("#startDate").datepicker("setDate",y),$("#endDate").datepicker("setDate",v),$("#search-input").val(""),E.checked=!0,S.checked=!1,C.checked=!1,I.clear(),document.querySelectorAll(".industry-btn").forEach(function(e){return e.classList.remove("active")}),B(),A())}),$("#search-input").on("input",D(function(){B(),A()},500)),console.timeEnd("Data Processing"),B(),A()}(e)}).catch(function(e){return console.error("Error loading data:",e)});var E=document.getElementById("archivedFilter"),S=document.getElementById("caseFilter"),C=document.getElementById("unreliableFilter"),I=new Set;function T(e,t){e.classList.toggle("active"),I.has(t)?I.delete(t):I.add(t),B(),A()}function x(e,t,n){$(e).select2({data:t.map(function(e){return{id:e,text:e}}),placeholder:n}).on("change",function(){B(),A()})}function O(){var e=$("#countryFilter").val()||[],t=$("#corruptionCategoriesFilter").val()||[],n=$("#healthCategoriesFilter").val()||[],o=$("#startDate").datepicker("getDate"),r=$("#endDate").datepicker("getDate"),a=$("#search-input").val().trim(),i=!E.checked,c=C.checked,l=S.checked,s=I.size>0,u=o&&y&&o.getTime()!==y.getTime()||r&&v&&r.getTime()!==v.getTime();return e.length>0||t.length>0||n.length>0||u||""!==a||i||c||l||s}function A(){O()?$("#resetFilters").show():$("#resetFilters").hide()}document.getElementById("health-industry").addEventListener("click",function(){T(this,"Health")}),document.getElementById("defence-industry").addEventListener("click",function(){T(this,"Defence")});var j=d3.timeParse("%d/%m/%y");function B(){console.time("Filtering Data");var e=new Set($("#countryFilter").val()||[]),t=new Set($("#corruptionCategoriesFilter").val()||[]),o=new Set($("#healthCategoriesFilter").val()||[]),r=$("#startDate").datepicker("getDate"),a=$("#endDate").datepicker("getDate"),i=$("#search-input").val().toLowerCase().trim(),c=E.checked,l=S.checked,s=C.checked;w=b.filter(function(n){var u=0===e.size||e.has(n.country),d=0===t.size||n["Corruption Categories"].some(function(e){return t.has(e)}),p=0===o.size||n["Sector Categories"].some(function(e){return o.has(e)}),f=!0;r&&a&&n.parsedDate&&(f=n.parsedDate>=r&&n.parsedDate<=a);var h=!0;if(i){var m=n.Title.toLowerCase();h=i.startsWith('"')&&i.endsWith('"')?m.includes(i.slice(1,-1)):i.split(" ").every(function(e){return m.includes(e)})}var g=c||!n.Archived,y=l||n.c_n,v=s||!n.f_n,b=0===I.size||n.Industry&&n.Industry.some(function(e){return I.has(e)});return u&&d&&p&&f&&h&&g&&v&&y&&b}),console.timeEnd("Filtering Data"),function(){if(console.time("Updating Map and Table"),f.clearLayers(),k.clear(),w.length>0){var e=1e3,t=0;!function o(){var r=Math.min(t+e,w.length);var a=[];for(var i=t;i<r;i++){var c=w[i],l="".concat(c.lat,"-").concat(c.long,"-").concat(c.Title);if(!k.has(l)){var s=L.marker([c.lat,c.long]).bindPopup('\n  <div class="popup-content">\n    <h3 class="popup-title">"'.concat(c.Title,'"</h3>\n    <div class="popup-details">\n      <p><strong>Country:</strong> ').concat(c.country,'</p>\n      <p><strong>URL:</strong> <a href="').concat(c.url,'" target="_blank">Link</a></p>\n      <p><strong>Date:</strong> ').concat(c.Date,"</p>\n      <p><strong>Corruption Type:</strong> ").concat(String(c["Corruption Categories"]||"").replace(/,(?=[^\s])/g,", "),"</p>\n      <p><strong>Sector Area:</strong> ").concat(String(c["Sector Categories"]||"").replace(/,(?=[^\s])/g,", "),"</p>\n    </div>\n  </div>\n"));a.push(s),k.set(l,s)}}f.addLayers(a);t=r;t<w.length?setTimeout(o,0):(n.fitBounds(f.getBounds()),F())}()}else F();console.timeEnd("Updating Map and Table")}()}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("twitter_share");e&&e.addEventListener("click",U);var t=document.getElementById("lin_share");t&&t.addEventListener("click",W)}),document.querySelector("#clicker").addEventListener("click",function(){var e=document.querySelector(".filter-content"),t=document.querySelector(".expand-icon");e.classList.toggle("expanded"),t.classList.toggle("expanded")});var F=D(function(){if(console.time("Updating Visible Data"),!n.isMoving()){var e=n.getBounds(),t=w.filter(function(t){return e.contains(L.latLng(t.lat,t.long))});h.clear().rows.add(t).draw(),$(".filter-count").text(g(t.length)),console.timeEnd("Updating Visible Data")}},1e3);n.on("movestart",function(){n.isMoving=function(){return!0}}),n.on("moveend",function(){n.isMoving=function(){return!1},F()}),console.timeEnd("Total Initialization");var M={country:"Country mentioned in the article. This is usually, but not always, where the story occured.",corruption:"We used AI to identify when a story is related to a particular type of corruption. See our 'About' page for qualifications and limitations.",health:"We used AI to identify when a story is related to a particular area of health. See our 'About' page for qualifications and limitations.",date:"Set a date range to view which events have happened within a specific time period. Our archived data uses publication date.",archived:"When checked, this includes articles collected using our earlier data gathering methods. We've since improved our collection process. Unchecked shows only articles collected with our current methods.",cased:"When unchecked, this filters out general discussions and commentaries to focus on stories about specific corruption cases. Check it to include all articles.",unreliable:"We use AI to identify potentially unreliable news stories based on their writing style and content. While keeping this unchecked can help reduce exposure to low-quality news, please note: The filter works automatically and cannot fully understand context. It may incorrectly flag legitimate stories as unreliable. It may miss unreliable stories. It can reflect biases present in AI training data. Think of it as a helpful but unverified first pass rather than a definitive assessment of reliability.",industry:"Filter articles by industry sector. Select Health, Defence, or both. When both are selected, no filter is applied."},z=null;function P(e){console.log("Info icon clicked:",this.id),e.preventDefault(),e.stopPropagation();var t=this.getAttribute("data-filter");!function(e,t){console.log("Creating info box for:",e),z&&z.remove();var n=document.createElement("div");n.className="info-box",n.textContent=e,document.body.appendChild(n);var o=t.getBoundingClientRect();n.style.top="".concat(o.bottom+window.scrollY+5,"px"),n.style.left="".concat(o.left+window.scrollX-150,"px"),n.style.display="block",z=n,console.log("Info box created and displayed")}(M[t],this)}E.addEventListener("change",function(){B(),A()}),C.addEventListener("change",function(){B(),A()}),S.addEventListener("change",function(){B(),A()});["main-info","country-info","corruption-info","health-info","date-info","archived-info","case-info","unreliable-info","industry-info"].forEach(function(e){var t=document.getElementById(e);t?(console.log("Attaching click event to:",e),t.addEventListener("click",P),t.addEventListener("mousedown",function(e){return e.preventDefault()})):console.warn("Info icon not found:",e)}),document.addEventListener("click",function(e){z&&!e.target.classList.contains("info-icon")&&(console.log("Closing info box"),z.remove(),z=null)}),$(".filter-group select").off("select2:open");$("<button>").addClass("btn btn-sm btn-outline-secondary export-csv-button btn-sharer").html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1z"/><path fill-rule="evenodd" d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708z"/></svg>').attr("title","Export filtered data to CSV").appendTo("#export-button-container").on("click",function(){var e=w,t=[];t.push(["Title","Country/Region","URL","Date"].join(",")),e.forEach(function(e){var n=['"'+(e.Title||"").replace(/"/g,'""')+'"','"'+(e.country||"").replace(/"/g,'""')+'"','"'+(e.url||"").replace(/"/g,'""')+'"','"'+(e.Date||"").replace(/"/g,'""')+'"'];t.push(n.join(","))});var n=t.join("\n"),o=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(void 0!==r.download){var a=URL.createObjectURL(o);r.setAttribute("href",a),r.setAttribute("download","export.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}});function U(){var e=window.location.href.split("?")[0],t="https://twitter.com/intent/tweet?text="+encodeURIComponent("Explore global health sector integrity issues and scandals: "+e);window.open(t,"_blank")}function W(){window.location.href.split("?")[0];var e="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("https://ti-health.org/");window.open(e,"_blank","toolbar=no,location=0,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=250,top=300,left=300")}var _=document.getElementById("twitter_share");_&&_.addEventListener("click",U);var q=document.getElementById("lin_share");q&&q.addEventListener("click",W)});
},{}]},{},["quTw"], null)